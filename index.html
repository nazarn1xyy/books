<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Libify</title>
  <link rel="preconnect" href="https://images.unsplash.com" />
  <link rel="dns-prefetch" href="https://images.unsplash.com" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  // Critical: Cache Recovery Script
  // If the main bundle fails to load (MIME error / SyntaxError), unregister SW and reload.
  window.addEventListener('error', async function (e) {
  const msg = e.message?.toLowerCase() || '';
  const isChunkError = msg.includes('token') || msg.includes('syntax') || msg.includes('script error') ||
  msg.includes('mime');

  if (e.target && (e.target.tagName === 'SCRIPT' || isChunkError)) {
  console.error('Critical boot error detected:', e);

  // Unregister Service Workers
  if ('serviceWorker' in navigator) {
  const registrations = await navigator.serviceWorker.getRegistrations();
  for (const registration of registrations) {
  await registration.unregister();
  }
  }

  // Reload if not already reloaded recently (check sessionStorage)
  if (!sessionStorage.getItem('retry_boot')) {
  sessionStorage.setItem('retry_boot', 'true');
  window.location.reload();
  } else {
  sessionStorage.removeItem('retry_boot'); // Reset for next valid session
  }
  }
  }, true);
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>